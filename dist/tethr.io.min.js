!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=a("./lib/tethr")},{"./lib/tethr":6}],2:[function(a,b,c){c.PeerConnection=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,c.RTCIceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate},{}],3:[function(a,b,c){c.peer_connection_config={optional:[{RtpDataChannels:!0},{DtlsSrtpKeyAgreement:!0}]},c.data_channel_options={reliable:!1}},{}],4:[function(a,b,c){function d(a,b){this.pc=new g.PeerConnection(a.ice,h.peer_connection_config),this.rtc=a,this.id=b,this.listen()}var e=a("events"),f=a("inherits"),g=a("./client"),h=a("./configs");c.connect=function(a,b){return new d(a,b)},f(d,e.EventEmitter),d.prototype.listen=function(){var a=this.pc,b=this;a.onicecandidate=function(a){if(a.candidate){var c=a.candidate;b.rtc.socket.send("send_ice_candidate",{label:c.sdpMLineIndex,candidate:c.candidate,socketId:b.id})}},a.onopen=function(){b.emit("open"),b.create_data_channel()},a.onerror=function(a){b.rtc.emit("error",a)},a.onclose=function(){b.emit("close")}},d.prototype.send=function(a){if(!this.channel)throw new Error("PeerConnection has no data channel!");this.channel.send(a)},d.prototype.add_ice_candidate=function(a){var b=new g.RTCIceCandidate(a);this.pc.addIceCandidate(b)},d.prototype.create_data_channel=function(){var a=this,b=a.pc,c=a.channel=b.createDataChannel("tethr.io",h.data_channel_options);c.onopen=function(){a.emit("data open",c)},c.onerror=function(b){a.rtc.emit("error",b)},c.onclose=function(){a.emit("data close")},c.onmessage=function(b){a.emit("data message",b)}}},{"./client":2,"./configs":3,events:9,inherits:10}],5:[function(a,b){function c(a){this._peer=a,this.id=a.id,this._listen()}var d=a("events"),e=a("inherits");b.exports=c,e(c,d.EventEmitter),c.prototype._listen=function(){var a=this;a.on("close",a.emit.bind(a,"leave")),a.on("data close",a.emit.bind(a,"leave")),a.on("data message",function(b){var c;try{c=JSON.parse(b.data)}catch(d){return a.emit("error",new Error("Couldnt parse message: "+b.data)),void 0}a.emit(c.type,c.data)})},c.prototype.send=function(a,b){if(/^leave$/.test(a))throw new Error("Can't send a message type "+a);var c={type:a,data:b};this.channel.send(JSON.stringify(c))}},{events:9,inherits:10}],6:[function(a,b){function c(){this.peers={}}var d=a("events"),e=a("inherits"),f=a("./webrtc"),g=a("./tether-peer");e(c,d.EventEmitter),c.prototype.connect=function(a){this.rtc=f.connect(a),this.listen()},c.prototype.listen=function(){var a=this;a.rtc.on("socket open",function(){a.emit("connect")}),a.rtc.on("peer new",function(b){var c=a._peers[b.id]=new g(b);a.emit("join",c)})},c.prototype.id=function(){return this.rtc.id},c.prototype.peer=function(a){return this._peers[a]},c.prototype.eachPeer=function(a){var b=this;Object.keys(b._peers).forEach(function(c){a(b._peers[c],c)})},c.prototype.broadcast=function(a,b){var c=this;c.eachPeer(function(c){c.send(a,b)})},b.exports=new c},{"./tether-peer":5,"./webrtc":7,events:9,inherits:10}],7:[function(a,b,c){function d(a){var b=this;b.server=a.server||window.document.location.host,b.room=a.room||"",b.ice=a.ice||null,b.secure=a.secure||!1,b.reconnect_limit=a.reconnect_limit||1,b.peers={}}var e=a("events"),f=a("inherits"),g=a("./websocket"),h=a("./peer");c.connect=function(a){return new d(a)},f(d,e.EventEmitter),d.prototype.connect=function(){var a=this,b=(a.secure?"wss":"ws")+"://"+a.server;a.socket=g.connect(a,b),a.attach_socket_listeners()},d.prototype.reconnect=function(){var a=this;return a._reconnected=(a._reconnected||0)+1,a._reconnected>a.reconnect_limit?a.emit("error",new Error("too many socket reconnections!")):(a.connect(),void 0)},d.prototype.attach_socket_listeners=function(){var a=this;a.on("socket open",function(b){b.send("join_room",{room:a.room}),a.attach_comm_listeners()}),a.on("socket close",function(){a.emit("error",new Error("socket closed unexpectedly, trying to reconnect")),a.reconnect()})},d.prototype.attach_comm_listeners=function(){var a=this;a.on("get_peers",function(b){a._id=b.you,b.connections.forEach(a.add_peer.bind(a))}),a.on("receive_ice_candidate",function(b){a.peers[b.socketId]._add_ice_candidate(b)}),a.on("new_peer_connected",function(b){a.add_peer(b.socketId)}),a.on("remove_peer_connected",function(b){a.remove_peer(b.socketId)})},d.prototype.add_peer=function(a){var b=this,c=b.peers[a]=h.connect(b,a);b.emit("peer new",c)}},{"./peer":4,"./websocket":8,events:9,inherits:10}],8:[function(a,b,c){c.connect=function(a,b){var c=new WebSocket(b);c.onopen=function(){a.emit("socket open",c)},c.onerror=function(b){a.emit("error",b)},c.onclose=function(){a.emit("socket close",c)},c.onmessage=function(b){var c;try{c=JSON.parse(b.data)}catch(d){return a.emit("error",new Error("Error parsing socket message: "+b.data)),void 0}a.emit(c.eventName,c.data)};var d=c.send;c.send=function(a,b){var c={eventName:a,data:b};return d(JSON.stringify(c))}}},{}],9:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],10:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}]},{},[1]);