!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=a("./lib/tethr")},{"./lib/tethr":2}],2:[function(a,b){function c(){this._peers={}}function d(a,b){this._tether=a,this._chan=b,this.id=b._id,this._listen()}var e=a("../node_modules/webrtc.io-client/lib/webrtc.io.js"),f=a("events"),g=a("inherits");g(c,f.EventEmitter),c.prototype.connect=function(a,b){b=b||{};var c=b.host||window.document.location.host,d=b.ice||{iceServers:[{url:"stun:stun.l.google.com:19302"}]},f=b.secure?"wss":"ws";this._listen(),e.SERVER=function(){return d},e.connect(f+"://"+c,a)},c.prototype._listen=function(){var a=this;e.on("connect",function(){a.emit("connect")}),e.on("connections",function(){e.fire("ready")}),e.on("data stream open",function(b){var c=a._peers[b._id]=new d(a,b);a.emit("join",c)})},c.prototype.id=function(){return e._me},c.prototype.peer=function(a){return this._peers[a]},c.prototype.eachPeer=function(a){var b=this;Object.keys(b._peers).forEach(function(c){a(b._peers[c],c)})},c.prototype.broadcast=function(a){var b=this;b.eachPeer(function(b){b.send(a)})},g(d,f.EventEmitter),d.prototype._listen=function(){var a=this,b=this._tether;a._chan.onclose=function(){a.emit("leave"),b.emit("leave",a),e.fire("remove_peer_connected",{socketId:a.id})},a._chan.onerror=function(a){b.emit("error",a)},a._chan.onmessage=function(c){var d;try{d=JSON.parse(c.data)}catch(e){return b.emit("error",new Error("JSON could not parse: "+c.data)),void 0}var f=d.from,g=d.msg;a.emit("message",g,b.peer(f))}},d.prototype.send=function(a){var b=this,c={from:b._tether.id(),msg:a};b._chan.send(JSON.stringify(c))},b.exports=new c},{"../node_modules/webrtc.io-client/lib/webrtc.io.js":5,events:3,inherits:4}],3:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],4:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],5:[function(a,b){function c(a){for(var b=a.split("\r\n"),c=null,g=0;g<b.length;g++)if(-1!==b[g].search("m=audio")){c=g;break}if(null===c)return a;for(var h=0;h<b.length;h++)if(-1!==b[h].search("opus/48000")){var i=d(b[h],/:(\d+) opus\/48000/i);i&&(b[c]=e(b[c],i));break}return b=f(b,c),a=b.join("\r\n")}function d(a,b){var c=a.match(b);return c&&2==c.length?c[1]:null}function e(a,b){for(var c=a.split(" "),d=[],e=0,f=0;f<c.length;f++)3===e&&(d[e++]=b),c[f]!==b&&(d[e++]=c[f]);return d.join(" ")}function f(a,b){for(var c=a[b].split(" "),e=a.length-1;e>=0;e--){var f=d(a[e],/a=rtpmap:(\d+) CN\/\d+/i);if(f){var g=c.indexOf(f);-1!==g&&c.splice(g,1),a.splice(e,1)}}return a[b]=c.join(" "),a}function g(a,b){var c=a;for(var d in b.mandatory)c.mandatory[d]=b.mandatory[d];return c.optional.concat(b.optional),c}var h=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,i=(window.URL||window.webkitURL||window.msURL||window.oURL,navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),j=window.mozRTCIceCandidate||window.RTCIceCandidate,k=window.mozRTCSessionDescription||window.RTCSessionDescription,l={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};navigator.webkitGetUserMedia&&(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),function(){var a;a="undefined"==typeof b?this.rtc={}:b.exports={},a.debug=!1,a._socket=null,a._me=null,a._events={},a.on=function(b,c){a._events[b]=a._events[b]||[],a._events[b].push(c)},a.fire=function(b){var c=a._events[b],d=Array.prototype.slice.call(arguments,1);if(c)for(var e=0,f=c.length;f>e;e++)c[e].apply(null,d)},a.SERVER=function(){return navigator.mozGetUserMedia?{iceServers:[{url:"stun:23.21.150.121"}]}:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}},a.peerConnections={},a.connections=[],a.streams=[],a.numStreams=0,a.initializedStreams=0,a.dataChannels={},a.dataChannelConfig={optional:[{RtpDataChannels:!0},{DtlsSrtpKeyAgreement:!0}]},a.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!0}]},a.checkDataChannelSupport=function(){try{var b=new h(a.SERVER(),a.dataChannelConfig),c=b.createDataChannel("supportCheck",{reliable:!1});return c.close(),!0}catch(d){return!1}},a.dataChannelSupport=a.checkDataChannelSupport(),a.connect=function(b,c){c=c||"",a._socket=new WebSocket(b),a._socket.onopen=function(){a._socket.send(JSON.stringify({eventName:"join_room",data:{room:c}})),a._socket.onmessage=function(b){var c=JSON.parse(b.data);a.fire(c.eventName,c.data)},a._socket.onerror=function(a){console.error("onerror"),console.error(a)},a._socket.onclose=function(){var b=a._socket.id;a.fire("disconnect stream",b),"undefined"!=typeof a.peerConnections[b]&&a.peerConnections[b].close(),delete a.peerConnections[b],delete a.dataChannels[b],delete a.connections[b]},a.on("get_peers",function(b){a.connections=b.connections,a._me=b.you,a.offerSent&&(a.createPeerConnections(),a.addStreams(),a.addDataChannels(),a.sendOffers()),a.fire("connections",a.connections)}),a.on("receive_ice_candidate",function(b){var c=new j(b);a.peerConnections[b.socketId].addIceCandidate(c),a.fire("receive ice candidate",c)}),a.on("new_peer_connected",function(b){var c=b.socketId;a.connections.push(c),delete a.offerSent;for(var d=a.createPeerConnection(c),e=0;e<a.streams.length;e++){var f=a.streams[e];d.addStream(f)}}),a.on("remove_peer_connected",function(b){var c=b.socketId;a.fire("disconnect stream",c),"undefined"!=typeof a.peerConnections[c]&&a.peerConnections[c].close(),delete a.peerConnections[c],delete a.dataChannels[c],delete a.connections[c]}),a.on("receive_offer",function(b){a.receiveOffer(b.socketId,b.sdp),a.fire("receive offer",b)}),a.on("receive_answer",function(b){a.receiveAnswer(b.socketId,b.sdp),a.fire("receive answer",b)}),a.fire("connect")}},a.sendOffers=function(){for(var b=0,c=a.connections.length;c>b;b++){var d=a.connections[b];a.sendOffer(d)}},a.onClose=function(b){a.on("close_stream",function(){a.fire("close_stream",b)})},a.createPeerConnections=function(){for(var b=0;b<a.connections.length;b++)a.createPeerConnection(a.connections[b])},a.createPeerConnection=function(b){var c=a.pc_constraints;a.dataChannelSupport&&(c=a.dataChannelConfig);var d=a.peerConnections[b]=new h(a.SERVER(),c);return d.onicecandidate=function(c){c.candidate&&a._socket.send(JSON.stringify({eventName:"send_ice_candidate",data:{label:c.candidate.sdpMLineIndex,candidate:c.candidate.candidate,socketId:b}})),a.fire("ice candidate",c.candidate)},d.onopen=function(){a.fire("peer connection opened")},d.onaddstream=function(c){a.fire("add remote stream",c.stream,b)},a.dataChannelSupport&&(d.ondatachannel=function(c){a.debug&&console.log("data channel connecting "+b),a.addDataChannel(b,c.channel)}),d},a.sendOffer=function(b){var d=a.peerConnections[b],e={optional:[],mandatory:{MozDontOfferDataChannel:!0}};if(navigator.webkitGetUserMedia)for(var f in e.mandatory)-1!=f.indexOf("Moz")&&delete e.mandatory[f];e=g(e,l),d.createOffer(function(e){e.sdp=c(e.sdp),d.setLocalDescription(e),a._socket.send(JSON.stringify({eventName:"send_offer",data:{socketId:b,sdp:e}}))},null,l)},a.receiveOffer=function(b,c){a.peerConnections[b];a.sendAnswer(b,c)},a.sendAnswer=function(b,c){var d=a.peerConnections[b];d.setRemoteDescription(new k(c)),d.createAnswer(function(c){d.setLocalDescription(c),a._socket.send(JSON.stringify({eventName:"send_answer",data:{socketId:b,sdp:c}}));d.remoteDescription},null,l)},a.receiveAnswer=function(b,c){var d=a.peerConnections[b];d.setRemoteDescription(new k(c))},a.createStream=function(b,c,d){var e;c=c||function(){},d=d||function(){},e={video:!!b.video,audio:!!b.audio},i?(a.numStreams++,i.call(navigator,e,function(b){a.streams.push(b),a.initializedStreams++,c(b),a.initializedStreams===a.numStreams&&a.fire("ready")},function(a){alert("Could not connect stream."),d(a)})):alert("webRTC is not yet supported in this browser.")},a.addStreams=function(){for(var b=0;b<a.streams.length;b++){var c=a.streams[b];for(var d in a.peerConnections)a.peerConnections[d].addStream(c)}},a.attachStream=function(b,c){"string"==typeof c&&(c=document.getElementById(c)),navigator.mozGetUserMedia?(a.debug&&console.log("Attaching media stream"),c.mozSrcObject=b,c.play()):c.src=webkitURL.createObjectURL(b)},a.createDataChannel=function(b,c){if(!a.dataChannelSupport)return alert("webRTC data channel is not yet supported in this browser, or you must turn on experimental flags"),void 0;var d,e;if("string"==typeof b)d=b,e=a.peerConnections[b];else{e=b,d=void 0;for(var f in a.peerConnections)a.peerConnections[f]===e&&(d=f)}if(!d)throw new Error("attempt to createDataChannel with unknown id");if(!(e&&e instanceof h))throw new Error("attempt to createDataChannel without peerConnection");c=c||"fileTransfer"||String(d);var g,i={reliable:!1};try{a.debug&&console.log("createDataChannel "+d),g=e.createDataChannel(c,i)}catch(j){throw a.debug&&console.log("seems that DataChannel is NOT actually supported!"),j}return a.addDataChannel(d,g)},a.addDataChannel=function(b,c){return c._id=b,c.onopen=function(){a.debug&&console.log("data stream open "+b),a.fire("data stream open",c)},c.onclose=function(){delete a.dataChannels[b],delete a.peerConnections[b],delete a.connections[b],a.debug&&console.log("data stream close "+b),a.fire("data stream close",c)},c.onmessage=function(d){a.debug&&console.log("data stream message "+b),a.fire("data stream data",c,d.data)},c.onerror=function(d){a.debug&&console.log("data stream error "+b+": "+d),a.fire("data stream error",c,d)},a.dataChannels[b]=c,c},a.addDataChannels=function(){if(a.dataChannelSupport)for(var b in a.peerConnections)a.createDataChannel(b)},a.on("ready",function(){a.createPeerConnections(),a.addStreams(),a.addDataChannels(),a.sendOffers(),a.offerSent=!0})}.call(this)},{}]},{},[1]);